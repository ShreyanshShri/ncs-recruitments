generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

enum Role {
  USER
  ADMIN
}

enum Domain {
  PROGRAMMING
  DEV
  DESIGN
  TECHNICAL
}

enum ApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  SHORTLISTED
  REJECTED
  SELECTED
}

enum RoundType {
  MCQ
  OFFLINE
}

enum SubmissionStatus {
  NOT_STARTED
  STARTED
  SUBMITTED
  EVALUATED
}

enum QuestionType {
  MCQ
  INPUT
}

enum RoundScope {
  COMMON
  DOMAIN
}

enum Institution {
  AKTU
  JSSUNI
}

enum Year {
  FIRST
  SECOND
  THIRD
  FOURTH
}

enum Branch {
  CSE
  CSE_AIML
  CSE_DS
  IT
  ECE
  MECHANICAL
  RAI
  EEE
  EE
  CIVIL
}

model User {
  id       String  @id @default(cuid())
  name     String?
  email    String  @unique
  password String?
  role     String  @default("USER") // Changed to String for SQLite compatibility

  applications Application[]
  submissions  Submission[]
  profile      UserProfile?

  createdAt DateTime @default(now())

  @@map("users")
}

model UserProfile {
  id String @id @default(cuid())

  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  rollNumber String
  mobile     String

  institution String // Changed to String for SQLite compatibility
  year        String // Changed to String for SQLite compatibility
  branch      String // Changed to String for SQLite compatibility

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Application {
  id String @id @default(cuid())

  userId String
  domain String // Changed to String for SQLite compatibility

  status String @default("SUBMITTED") // Changed to String for SQLite compatibility

  user        User         @relation(fields: [userId], references: [id])
  submissions Submission[]

  createdAt DateTime @default(now())

  @@unique([userId, domain])
}

model Round {
  id String @id @default(cuid())

  scope  String // Changed to String for SQLite compatibility
  domain String? // Changed to String for SQLite compatibility
  order  Int

  type  String // Changed to String for SQLite compatibility
  title String

  isActive    Boolean   @default(false)
  isPublished Boolean   @default(false)
  publishedAt DateTime?

  startTime DateTime?
  endTime   DateTime?

  cutoff   Float?
  maxScore Float?

  markingScheme String? // Changed to String (JSON stored as string) for SQLite compatibility

  submissions Submission[]
  questions   Question[]

  createdAt DateTime @default(now())

  @@unique([domain, order])
}

model Question {
  id      String @id @default(cuid())
  roundId String

  question String

  type String // Changed to String for SQLite compatibility

  options String? // Changed to String (JSON stored as string) for SQLite compatibility

  answer String
  marks  Float

  round Round @relation(fields: [roundId], references: [id])
}

model Submission {
  id String @id @default(cuid())

  roundId String

  userId        String?
  applicationId String?

  status String @default("NOT_STARTED") // Changed to String for SQLite compatibility

  score     Float?
  responses String? // Changed to String (JSON stored as string) for SQLite compatibility

  user        User?        @relation(fields: [userId], references: [id])
  application Application? @relation(fields: [applicationId], references: [id])
  round       Round        @relation(fields: [roundId], references: [id])

  evaluatedBy String?

  createdAt DateTime @default(now())

  @@unique([applicationId, roundId])
  @@unique([userId, roundId])
}
