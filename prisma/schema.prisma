generator client {
  provider = "prisma-client"
  output   = "../app/generated/client"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String        @id @default(cuid())
  name         String?
  email        String        @unique
  password     String?
  role         Role          @default(USER)
  createdAt    DateTime      @default(now())
  applications Application[]
  submissions  Submission[]
  profile      UserProfile?

  @@map("users")
}

model UserProfile {
  id          String      @id @default(cuid())
  userId      String      @unique
  rollNumber  String
  mobile      String
  institution Institution
  year        Year
  branch      Branch
  linkedIn    String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Application {
  id          String            @id @default(cuid())
  userId      String
  domain      Domain
  status      ApplicationStatus @default(SUBMITTED)
  createdAt   DateTime          @default(now())
  user        User              @relation(fields: [userId], references: [id])
  submissions Submission[]

  @@unique([userId, domain])
}

model Round {
  id            String       @id @default(cuid())
  domain        Domain?
  type          RoundType
  title         String
  isActive      Boolean      @default(false)
  cutoff        Float?
  maxScore      Float?
  createdAt     DateTime     @default(now())
  endTime       DateTime?
  markingScheme Json?
  startTime     DateTime?
  order         Int
  year          Year
  isPublished   Boolean      @default(false)
  publishedAt   DateTime?
  scope         RoundScope
  questions     Question[]
  submissions   Submission[]

  @@unique([domain, order])
}

model Question {
  id       String       @id @default(cuid())
  roundId  String
  question String
  options  Json?
  answer   String
  marks    Float
  type     QuestionType
  round    Round        @relation(fields: [roundId], references: [id])
}

model Submission {
  id            String           @id @default(cuid())
  applicationId String?
  roundId       String
  status        SubmissionStatus @default(NOT_STARTED)
  score         Float?
  responses     Json?
  resumeUrl     String?
  evaluatedBy   String?
  createdAt     DateTime         @default(now())
  userId        String?
  application   Application?     @relation(fields: [applicationId], references: [id])
  round         Round            @relation(fields: [roundId], references: [id])
  user          User?            @relation(fields: [userId], references: [id])

  @@unique([applicationId, roundId])
  @@unique([userId, roundId])
}

model Notification {
  id    String @id @default(cuid())
  title String
  body  String

  year   Year
  scope  RoundScope
  domain Domain?

  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  publishedAt DateTime @default(now())

  @@index([year, scope, domain, isActive])
}

enum Role {
  USER
  ADMIN
}

enum Domain {
  PROGRAMMING
  DEV
  DESIGN
  TECHNICAL
}

enum ApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  SHORTLISTED
  REJECTED
  SELECTED
}

enum RoundType {
  MCQ
  OFFLINE
  RESUME
}

enum SubmissionStatus {
  NOT_STARTED
  STARTED
  SUBMITTED
  EVALUATED
}

enum QuestionType {
  MCQ
  INPUT
}

enum RoundScope {
  COMMON
  DOMAIN
}

enum Institution {
  AKTU
  JSSUNI
}

enum Year {
  FIRST
  SECOND
  THIRD
  FOURTH
}

enum Branch {
  CSE
  CSE_AIML
  CSE_DS
  IT
  ECE
  MECHANICAL
  RAI
  EEE
  EE
  CIVIL
}
